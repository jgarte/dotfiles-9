#! /usr/bin/env bash

set -eux

if [ -z "${1:-}" ]; then
    SESSION="$(tty)"
else
    SESSION="$1"
fi

SESSION="${SESSION#/dev/}"

TERM=xterm

# shellcheck disable=SC2029
if ssh bastion tmux has -t "$SESSION"; then
    exec ssh bastion -t "tmux attach -t $SESSION"
else
    exec ssh bastion -t "tmux new -s $SESSION"
fi
